<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Definition.Modality.Substitution</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a><a id="4" class="Keyword">OPTIONS</a> <a id="12" class="Pragma">--without-K</a> <a id="24" class="Pragma">--safe</a> <a id="31" class="Symbol">#-}</a>

<a id="36" class="Keyword">open</a> <a id="41" class="Keyword">import</a> <a id="48" href="Tools.Level.html" class="Module">Tools.Level</a>
<a id="60" class="Keyword">open</a> <a id="65" class="Keyword">import</a> <a id="72" href="Tools.Relation.html" class="Module">Tools.Relation</a>
<a id="87" class="Keyword">open</a> <a id="92" class="Keyword">import</a> <a id="99" href="Definition.Modality.html" class="Module">Definition.Modality</a>

<a id="120" class="Keyword">module</a> <a id="127" href="Definition.Modality.Substitution.html" class="Module">Definition.Modality.Substitution</a>
  <a id="162" class="Symbol">{</a><a id="163" href="Definition.Modality.Substitution.html#163" class="Bound">M</a> <a id="165" class="Symbol">:</a> <a id="167" class="PrimitiveType">Set</a><a id="170" class="Symbol">}</a> <a id="172" class="Symbol">{</a><a id="173" href="Definition.Modality.Substitution.html#173" class="Bound Operator">_≈_</a> <a id="177" class="Symbol">:</a> <a id="179" href="Relation.Binary.Core.html#882" class="Function">Rel</a> <a id="183" href="Definition.Modality.Substitution.html#163" class="Bound">M</a> <a id="185" href="Tools.Level.html#109" class="Primitive">ℓ₀</a><a id="187" class="Symbol">}</a>
  <a id="191" class="Symbol">(</a><a id="192" href="Definition.Modality.Substitution.html#192" class="Bound">𝕄</a> <a id="194" class="Symbol">:</a> <a id="196" href="Definition.Modality.html#271" class="Record">Modality</a> <a id="205" href="Definition.Modality.Substitution.html#163" class="Bound">M</a> <a id="207" href="Definition.Modality.Substitution.html#173" class="Bound Operator">_≈_</a><a id="210" class="Symbol">)</a>
  <a id="214" class="Keyword">where</a>

<a id="221" class="Keyword">open</a> <a id="226" class="Keyword">import</a> <a id="233" href="Definition.Untyped.html" class="Module">Definition.Untyped</a> <a id="252" href="Definition.Modality.Substitution.html#163" class="Bound">M</a>
  <a id="256" class="Keyword">using</a> <a id="262" class="Symbol">(</a>Subst <a id="269" class="Symbol">;</a> tail <a id="276" class="Symbol">;</a> head <a id="283" class="Symbol">;</a> Wk <a id="288" class="Symbol">;</a> id <a id="293" class="Symbol">;</a> step <a id="300" class="Symbol">;</a> lift<a id="306" class="Symbol">)</a>
<a id="308" class="Keyword">open</a> <a id="313" class="Keyword">import</a> <a id="320" href="Definition.Untyped.Properties.html" class="Module">Definition.Untyped.Properties</a> <a id="350" href="Definition.Modality.Substitution.html#163" class="Bound">M</a>
<a id="352" class="Keyword">open</a> <a id="357" class="Keyword">import</a> <a id="364" href="Definition.Modality.Context.html" class="Module">Definition.Modality.Context</a> <a id="392" href="Definition.Modality.Substitution.html#192" class="Bound">𝕄</a>
<a id="394" class="Keyword">open</a> <a id="399" class="Keyword">import</a> <a id="406" href="Definition.Modality.Context.Properties.html" class="Module">Definition.Modality.Context.Properties</a> <a id="445" href="Definition.Modality.Substitution.html#192" class="Bound">𝕄</a>
<a id="447" class="Keyword">open</a> <a id="452" class="Keyword">import</a> <a id="459" href="Definition.Modality.Properties.html" class="Module">Definition.Modality.Properties</a> <a id="490" href="Definition.Modality.Substitution.html#192" class="Bound">𝕄</a>
<a id="492" class="Keyword">open</a> <a id="497" class="Keyword">import</a> <a id="504" href="Definition.Modality.Usage.html" class="Module">Definition.Modality.Usage</a> <a id="530" href="Definition.Modality.Substitution.html#192" class="Bound">𝕄</a>

<a id="533" class="Keyword">open</a> <a id="538" class="Keyword">import</a> <a id="545" href="Tools.Fin.html" class="Module">Tools.Fin</a>
<a id="555" class="Keyword">open</a> <a id="560" class="Keyword">import</a> <a id="567" href="Tools.Nat.html" class="Module">Tools.Nat</a>
<a id="577" class="Keyword">open</a> <a id="582" class="Keyword">import</a> <a id="589" href="Tools.Product.html" class="Module">Tools.Product</a>

<a id="604" class="Keyword">open</a> <a id="609" href="Definition.Modality.html#271" class="Module">Modality</a> <a id="618" href="Definition.Modality.Substitution.html#192" class="Bound">𝕄</a>

<a id="621" class="Keyword">infixr</a> <a id="628" class="Number">50</a> <a id="631" href="Definition.Modality.Substitution.html#979" class="Function Operator">_*&gt;_</a>
<a id="636" class="Keyword">infix</a>  <a id="643" class="Number">20</a> <a id="646" href="Definition.Modality.Substitution.html#1882" class="Function Operator">∥_∥</a>
<a id="650" class="Keyword">infixl</a> <a id="657" class="Number">30</a> <a id="660" href="Definition.Modality.Substitution.html#839" class="InductiveConstructor Operator">_⊙_</a>

<a id="665" class="Keyword">private</a>
  <a id="675" class="Keyword">variable</a>
    <a id="688" href="Definition.Modality.Substitution.html#688" class="Generalizable">ℓ</a> <a id="690" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a> <a id="692" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a> <a id="694" class="Symbol">:</a> <a id="696" href="Agda.Builtin.Nat.html#192" class="Datatype">Nat</a>

<a id="701" class="Comment">-- Substitutions are matrices represented as snoc-lists of modality contexts.</a>

<a id="780" class="Keyword">data</a> <a id="Substₘ"></a><a id="785" href="Definition.Modality.Substitution.html#785" class="Datatype">Substₘ</a> <a id="792" class="Symbol">:</a> <a id="794" class="Symbol">(</a><a id="795" href="Definition.Modality.Substitution.html#795" class="Bound">m</a> <a id="797" href="Definition.Modality.Substitution.html#797" class="Bound">n</a> <a id="799" class="Symbol">:</a> <a id="801" href="Agda.Builtin.Nat.html#192" class="Datatype">Nat</a><a id="804" class="Symbol">)</a> <a id="806" class="Symbol">→</a> <a id="808" class="PrimitiveType">Set</a> <a id="812" class="Keyword">where</a>
  <a id="Substₘ.[]"></a><a id="820" href="Definition.Modality.Substitution.html#820" class="InductiveConstructor">[]</a>  <a id="824" class="Symbol">:</a> <a id="826" href="Definition.Modality.Substitution.html#785" class="Datatype">Substₘ</a> <a id="833" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a> <a id="835" class="Number">0</a>
  <a id="Substₘ._⊙_"></a><a id="839" href="Definition.Modality.Substitution.html#839" class="InductiveConstructor Operator">_⊙_</a> <a id="843" class="Symbol">:</a> <a id="845" href="Definition.Modality.Substitution.html#785" class="Datatype">Substₘ</a> <a id="852" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a> <a id="854" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a> <a id="856" class="Symbol">→</a>  <a id="859" href="Definition.Modality.Context.html#594" class="Datatype">Conₘ</a> <a id="864" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a> <a id="866" class="Symbol">→</a> <a id="868" href="Definition.Modality.Substitution.html#785" class="Datatype">Substₘ</a> <a id="875" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a> <a id="877" class="Symbol">(</a><a id="878" href="Tools.Nat.html#406" class="InductiveConstructor">1+</a> <a id="881" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a><a id="882" class="Symbol">)</a>

<a id="885" class="Keyword">private</a>
  <a id="895" class="Keyword">variable</a>
    <a id="908" href="Definition.Modality.Substitution.html#908" class="Generalizable">Ψ</a> <a id="910" href="Definition.Modality.Substitution.html#910" class="Generalizable">Φ</a> <a id="912" class="Symbol">:</a> <a id="914" href="Definition.Modality.Substitution.html#785" class="Datatype">Substₘ</a> <a id="921" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a> <a id="923" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a>

<a id="926" class="Comment">-- Application of substitution matrix from the left</a>

<a id="_*&gt;_"></a><a id="979" href="Definition.Modality.Substitution.html#979" class="Function Operator">_*&gt;_</a> <a id="984" class="Symbol">:</a> <a id="986" class="Symbol">(</a><a id="987" href="Definition.Modality.Substitution.html#987" class="Bound">Ψ</a> <a id="989" class="Symbol">:</a> <a id="991" href="Definition.Modality.Substitution.html#785" class="Datatype">Substₘ</a> <a id="998" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a> <a id="1000" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a><a id="1001" class="Symbol">)</a> <a id="1003" class="Symbol">→</a> <a id="1005" class="Symbol">(</a><a id="1006" href="Definition.Modality.Substitution.html#1006" class="Bound">γ</a> <a id="1008" class="Symbol">:</a> <a id="1010" href="Definition.Modality.Context.html#594" class="Datatype">Conₘ</a> <a id="1015" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a><a id="1016" class="Symbol">)</a> <a id="1018" class="Symbol">→</a> <a id="1020" href="Definition.Modality.Context.html#594" class="Datatype">Conₘ</a> <a id="1025" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a>
<a id="1027" href="Definition.Modality.Substitution.html#820" class="InductiveConstructor">[]</a> <a id="1030" href="Definition.Modality.Substitution.html#979" class="Function Operator">*&gt;</a> <a id="1033" href="Definition.Modality.Context.html#619" class="InductiveConstructor">ε</a> <a id="1035" class="Symbol">=</a> <a id="1037" href="Definition.Modality.Context.html#2199" class="Function">𝟘ᶜ</a>
<a id="1040" class="Symbol">(</a><a id="1041" href="Definition.Modality.Substitution.html#1041" class="Bound">Ψ</a> <a id="1043" href="Definition.Modality.Substitution.html#839" class="InductiveConstructor Operator">⊙</a> <a id="1045" href="Definition.Modality.Substitution.html#1045" class="Bound">δ</a><a id="1046" class="Symbol">)</a> <a id="1048" href="Definition.Modality.Substitution.html#979" class="Function Operator">*&gt;</a> <a id="1051" class="Symbol">(</a><a id="1052" href="Definition.Modality.Substitution.html#1052" class="Bound">γ</a> <a id="1054" href="Definition.Modality.Context.html#634" class="InductiveConstructor Operator">∙</a> <a id="1056" href="Definition.Modality.Substitution.html#1056" class="Bound">p</a><a id="1057" class="Symbol">)</a> <a id="1059" class="Symbol">=</a> <a id="1061" href="Definition.Modality.Substitution.html#1056" class="Bound">p</a> <a id="1063" href="Definition.Modality.Context.html#1844" class="Function Operator">·ᶜ</a> <a id="1066" href="Definition.Modality.Substitution.html#1045" class="Bound">δ</a> <a id="1068" href="Definition.Modality.Context.html#1612" class="Function Operator">+ᶜ</a> <a id="1071" class="Symbol">(</a><a id="1072" href="Definition.Modality.Substitution.html#1041" class="Bound">Ψ</a> <a id="1074" href="Definition.Modality.Substitution.html#979" class="Function Operator">*&gt;</a> <a id="1077" href="Definition.Modality.Substitution.html#1052" class="Bound">γ</a><a id="1078" class="Symbol">)</a>

<a id="substₘ"></a><a id="1081" href="Definition.Modality.Substitution.html#1081" class="Function">substₘ</a> <a id="1088" class="Symbol">=</a> <a id="1090" href="Definition.Modality.Substitution.html#979" class="Function Operator">_*&gt;_</a>

<a id="1096" class="Comment">-- Application of substitution matrix from the right</a>

<a id="_&lt;*_"></a><a id="1150" href="Definition.Modality.Substitution.html#1150" class="Function Operator">_&lt;*_</a> <a id="1155" class="Symbol">:</a> <a id="1157" class="Symbol">(</a><a id="1158" href="Definition.Modality.Substitution.html#1158" class="Bound">γ</a> <a id="1160" class="Symbol">:</a> <a id="1162" href="Definition.Modality.Context.html#594" class="Datatype">Conₘ</a> <a id="1167" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a><a id="1168" class="Symbol">)</a> <a id="1170" class="Symbol">→</a> <a id="1172" class="Symbol">(</a><a id="1173" href="Definition.Modality.Substitution.html#1173" class="Bound">Ψ</a> <a id="1175" class="Symbol">:</a> <a id="1177" href="Definition.Modality.Substitution.html#785" class="Datatype">Substₘ</a> <a id="1184" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a> <a id="1186" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a><a id="1187" class="Symbol">)</a> <a id="1189" class="Symbol">→</a> <a id="1191" href="Definition.Modality.Context.html#594" class="Datatype">Conₘ</a> <a id="1196" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a>
<a id="1198" href="Definition.Modality.Substitution.html#1198" class="Bound">γ</a> <a id="1200" href="Definition.Modality.Substitution.html#1150" class="Function Operator">&lt;*</a> <a id="1203" href="Definition.Modality.Substitution.html#820" class="InductiveConstructor">[]</a> <a id="1206" class="Symbol">=</a> <a id="1208" href="Definition.Modality.Context.html#619" class="InductiveConstructor">ε</a>
<a id="1210" href="Definition.Modality.Substitution.html#1210" class="Bound">γ</a> <a id="1212" href="Definition.Modality.Substitution.html#1150" class="Function Operator">&lt;*</a> <a id="1215" class="Symbol">(</a><a id="1216" href="Definition.Modality.Substitution.html#1216" class="Bound">Ψ</a> <a id="1218" href="Definition.Modality.Substitution.html#839" class="InductiveConstructor Operator">⊙</a> <a id="1220" href="Definition.Modality.Substitution.html#1220" class="Bound">δ</a><a id="1221" class="Symbol">)</a> <a id="1223" class="Symbol">=</a> <a id="1225" class="Symbol">(</a><a id="1226" href="Definition.Modality.Substitution.html#1210" class="Bound">γ</a> <a id="1228" href="Definition.Modality.Substitution.html#1150" class="Function Operator">&lt;*</a> <a id="1231" href="Definition.Modality.Substitution.html#1216" class="Bound">Ψ</a><a id="1232" class="Symbol">)</a> <a id="1234" href="Definition.Modality.Context.html#634" class="InductiveConstructor Operator">∙</a> <a id="1236" class="Symbol">(</a><a id="1237" href="Definition.Modality.Substitution.html#1210" class="Bound">γ</a> <a id="1239" href="Definition.Modality.Context.html#1501" class="Function Operator">*</a> <a id="1241" href="Definition.Modality.Substitution.html#1220" class="Bound">δ</a><a id="1242" class="Symbol">)</a>

<a id="1245" class="Comment">-- Composition of substitution matrices</a>

<a id="_&lt;*&gt;_"></a><a id="1286" href="Definition.Modality.Substitution.html#1286" class="Function Operator">_&lt;*&gt;_</a> <a id="1292" class="Symbol">:</a> <a id="1294" class="Symbol">(</a><a id="1295" href="Definition.Modality.Substitution.html#1295" class="Bound">Ψ</a> <a id="1297" class="Symbol">:</a> <a id="1299" href="Definition.Modality.Substitution.html#785" class="Datatype">Substₘ</a> <a id="1306" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a> <a id="1308" href="Definition.Modality.Substitution.html#688" class="Generalizable">ℓ</a><a id="1309" class="Symbol">)</a> <a id="1311" class="Symbol">(</a><a id="1312" href="Definition.Modality.Substitution.html#1312" class="Bound">Φ</a> <a id="1314" class="Symbol">:</a> <a id="1316" href="Definition.Modality.Substitution.html#785" class="Datatype">Substₘ</a> <a id="1323" href="Definition.Modality.Substitution.html#688" class="Generalizable">ℓ</a> <a id="1325" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a><a id="1326" class="Symbol">)</a> <a id="1328" class="Symbol">→</a> <a id="1330" href="Definition.Modality.Substitution.html#785" class="Datatype">Substₘ</a> <a id="1337" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a> <a id="1339" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a>
<a id="1341" href="Definition.Modality.Substitution.html#1341" class="Bound">Ψ</a> <a id="1343" href="Definition.Modality.Substitution.html#1286" class="Function Operator">&lt;*&gt;</a> <a id="1347" href="Definition.Modality.Substitution.html#820" class="InductiveConstructor">[]</a> <a id="1350" class="Symbol">=</a> <a id="1352" href="Definition.Modality.Substitution.html#820" class="InductiveConstructor">[]</a>
<a id="1355" href="Definition.Modality.Substitution.html#1355" class="Bound">Ψ</a> <a id="1357" href="Definition.Modality.Substitution.html#1286" class="Function Operator">&lt;*&gt;</a> <a id="1361" class="Symbol">(</a><a id="1362" href="Definition.Modality.Substitution.html#1362" class="Bound">Φ</a> <a id="1364" href="Definition.Modality.Substitution.html#839" class="InductiveConstructor Operator">⊙</a> <a id="1366" href="Definition.Modality.Substitution.html#1366" class="Bound">δ</a><a id="1367" class="Symbol">)</a> <a id="1369" class="Symbol">=</a> <a id="1371" class="Symbol">(</a><a id="1372" href="Definition.Modality.Substitution.html#1355" class="Bound">Ψ</a> <a id="1374" href="Definition.Modality.Substitution.html#1286" class="Function Operator">&lt;*&gt;</a> <a id="1378" href="Definition.Modality.Substitution.html#1362" class="Bound">Φ</a><a id="1379" class="Symbol">)</a> <a id="1381" href="Definition.Modality.Substitution.html#839" class="InductiveConstructor Operator">⊙</a> <a id="1383" class="Symbol">(</a><a id="1384" href="Definition.Modality.Substitution.html#1355" class="Bound">Ψ</a> <a id="1386" href="Definition.Modality.Substitution.html#979" class="Function Operator">*&gt;</a> <a id="1389" href="Definition.Modality.Substitution.html#1366" class="Bound">δ</a><a id="1390" class="Symbol">)</a>

<a id="1393" class="Comment">-- Prepend a substitution matrix with a row</a>

<a id="addrow"></a><a id="1438" href="Definition.Modality.Substitution.html#1438" class="Function">addrow</a> <a id="1445" class="Symbol">:</a> <a id="1447" class="Symbol">(</a><a id="1448" href="Definition.Modality.Substitution.html#1448" class="Bound">Ψ</a> <a id="1450" class="Symbol">:</a> <a id="1452" href="Definition.Modality.Substitution.html#785" class="Datatype">Substₘ</a> <a id="1459" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a> <a id="1461" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a><a id="1462" class="Symbol">)</a> <a id="1464" class="Symbol">→</a> <a id="1466" class="Symbol">(</a><a id="1467" href="Definition.Modality.Substitution.html#1467" class="Bound">γ</a> <a id="1469" class="Symbol">:</a> <a id="1471" href="Definition.Modality.Context.html#594" class="Datatype">Conₘ</a> <a id="1476" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a><a id="1477" class="Symbol">)</a> <a id="1479" class="Symbol">→</a> <a id="1481" href="Definition.Modality.Substitution.html#785" class="Datatype">Substₘ</a> <a id="1488" class="Symbol">(</a><a id="1489" href="Tools.Nat.html#406" class="InductiveConstructor">1+</a> <a id="1492" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a><a id="1493" class="Symbol">)</a> <a id="1495" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a>
<a id="1497" href="Definition.Modality.Substitution.html#1438" class="Function">addrow</a> <a id="1504" href="Definition.Modality.Substitution.html#820" class="InductiveConstructor">[]</a> <a id="1507" href="Definition.Modality.Context.html#619" class="InductiveConstructor">ε</a> <a id="1509" class="Symbol">=</a> <a id="1511" href="Definition.Modality.Substitution.html#820" class="InductiveConstructor">[]</a>
<a id="1514" href="Definition.Modality.Substitution.html#1438" class="Function">addrow</a> <a id="1521" class="Symbol">(</a><a id="1522" href="Definition.Modality.Substitution.html#1522" class="Bound">Ψ</a> <a id="1524" href="Definition.Modality.Substitution.html#839" class="InductiveConstructor Operator">⊙</a> <a id="1526" href="Definition.Modality.Substitution.html#1526" class="Bound">δ</a><a id="1527" class="Symbol">)</a> <a id="1529" class="Symbol">(</a><a id="1530" href="Definition.Modality.Substitution.html#1530" class="Bound">γ</a> <a id="1532" href="Definition.Modality.Context.html#634" class="InductiveConstructor Operator">∙</a> <a id="1534" href="Definition.Modality.Substitution.html#1534" class="Bound">p</a><a id="1535" class="Symbol">)</a> <a id="1537" class="Symbol">=</a> <a id="1539" href="Definition.Modality.Substitution.html#1438" class="Function">addrow</a> <a id="1546" href="Definition.Modality.Substitution.html#1522" class="Bound">Ψ</a> <a id="1548" href="Definition.Modality.Substitution.html#1530" class="Bound">γ</a> <a id="1550" href="Definition.Modality.Substitution.html#839" class="InductiveConstructor Operator">⊙</a> <a id="1552" class="Symbol">(</a><a id="1553" href="Definition.Modality.Substitution.html#1526" class="Bound">δ</a> <a id="1555" href="Definition.Modality.Context.html#634" class="InductiveConstructor Operator">∙</a> <a id="1557" href="Definition.Modality.Substitution.html#1534" class="Bound">p</a><a id="1558" class="Symbol">)</a>

<a id="1561" class="Comment">---------------------------------------------------------------</a>

<a id="1626" class="Comment">-- Well formed modality substitutions</a>
<a id="1664" class="Comment">-- If ∀ x. γₓ ▸ σ x, where γₓ is the x-th column vector of Ψ, then Ψ ▶ σ</a>

<a id="_▶_"></a><a id="1738" href="Definition.Modality.Substitution.html#1738" class="Function Operator">_▶_</a> <a id="1742" class="Symbol">:</a> <a id="1744" class="Symbol">(</a><a id="1745" href="Definition.Modality.Substitution.html#1745" class="Bound">Ψ</a> <a id="1747" class="Symbol">:</a> <a id="1749" href="Definition.Modality.Substitution.html#785" class="Datatype">Substₘ</a> <a id="1756" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a> <a id="1758" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a><a id="1759" class="Symbol">)</a> <a id="1761" class="Symbol">→</a> <a id="1763" class="Symbol">(</a><a id="1764" href="Definition.Modality.Substitution.html#1764" class="Bound">σ</a> <a id="1766" class="Symbol">:</a> <a id="1768" href="Definition.Untyped.html#12607" class="Function">Subst</a> <a id="1774" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a> <a id="1776" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a><a id="1777" class="Symbol">)</a> <a id="1779" class="Symbol">→</a> <a id="1781" class="PrimitiveType">Set</a>
<a id="1785" href="Definition.Modality.Substitution.html#1738" class="Function Operator">_▶_</a> <a id="1789" class="Symbol">{</a><a id="1790" class="Argument">n</a> <a id="1792" class="Symbol">=</a> <a id="1794" href="Definition.Modality.Substitution.html#1794" class="Bound">n</a><a id="1795" class="Symbol">}</a> <a id="1797" href="Definition.Modality.Substitution.html#1797" class="Bound">Ψ</a> <a id="1799" href="Definition.Modality.Substitution.html#1799" class="Bound">σ</a> <a id="1801" class="Symbol">=</a> <a id="1803" class="Symbol">∀</a> <a id="1805" class="Symbol">(</a><a id="1806" href="Definition.Modality.Substitution.html#1806" class="Bound">x</a> <a id="1808" class="Symbol">:</a> <a id="1810" href="Data.Fin.Base.html#1146" class="Datatype">Fin</a> <a id="1814" href="Definition.Modality.Substitution.html#1794" class="Bound">n</a><a id="1815" class="Symbol">)</a> <a id="1817" class="Symbol">→</a> <a id="1819" class="Symbol">(</a><a id="1820" href="Definition.Modality.Substitution.html#1797" class="Bound">Ψ</a> <a id="1822" href="Definition.Modality.Substitution.html#979" class="Function Operator">*&gt;</a> <a id="1825" class="Symbol">(</a><a id="1826" href="Definition.Modality.Context.html#2199" class="Function">𝟘ᶜ</a> <a id="1829" href="Definition.Modality.Context.html#1005" class="Function Operator">,</a> <a id="1831" href="Definition.Modality.Substitution.html#1806" class="Bound">x</a> <a id="1833" href="Definition.Modality.Context.html#1005" class="Function Operator">≔</a> <a id="1835" href="Definition.Modality.html#655" class="Field">𝟙</a><a id="1836" class="Symbol">))</a> <a id="1839" href="Definition.Modality.Usage.html#767" class="Datatype Operator">▸</a> <a id="1841" class="Symbol">(</a><a id="1842" href="Definition.Modality.Substitution.html#1799" class="Bound">σ</a> <a id="1844" href="Definition.Modality.Substitution.html#1806" class="Bound">x</a><a id="1845" class="Symbol">)</a>

<a id="1848" class="Comment">-- Substitution matrix inference</a>

<a id="∥_∥"></a><a id="1882" href="Definition.Modality.Substitution.html#1882" class="Function Operator">∥_∥</a> <a id="1886" class="Symbol">:</a> <a id="1888" class="Symbol">(</a><a id="1889" href="Definition.Modality.Substitution.html#1889" class="Bound">σ</a> <a id="1891" class="Symbol">:</a> <a id="1893" href="Definition.Untyped.html#12607" class="Function">Subst</a> <a id="1899" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a> <a id="1901" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a><a id="1902" class="Symbol">)</a> <a id="1904" class="Symbol">→</a> <a id="1906" href="Definition.Modality.Substitution.html#785" class="Datatype">Substₘ</a> <a id="1913" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a> <a id="1915" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a>
<a id="1917" href="Definition.Modality.Substitution.html#1882" class="Function Operator">∥_∥</a> <a id="1921" class="Symbol">{</a><a id="1922" class="Argument">n</a> <a id="1924" class="Symbol">=</a> <a id="1926" class="Number">0</a><a id="1927" class="Symbol">}</a>    <a id="1932" href="Definition.Modality.Substitution.html#1932" class="Bound">σ</a> <a id="1934" class="Symbol">=</a> <a id="1936" href="Definition.Modality.Substitution.html#820" class="InductiveConstructor">[]</a>
<a id="1939" href="Definition.Modality.Substitution.html#1882" class="Function Operator">∥_∥</a> <a id="1943" class="Symbol">{</a><a id="1944" class="Argument">n</a> <a id="1946" class="Symbol">=</a> <a id="1948" href="Tools.Nat.html#406" class="InductiveConstructor">1+</a> <a id="1951" href="Definition.Modality.Substitution.html#1951" class="Bound">n</a><a id="1952" class="Symbol">}</a> <a id="1954" href="Definition.Modality.Substitution.html#1954" class="Bound">σ</a> <a id="1956" class="Symbol">=</a> <a id="1958" href="Definition.Modality.Substitution.html#1882" class="Function Operator">∥</a> <a id="1960" href="Definition.Untyped.html#13374" class="Function">tail</a> <a id="1965" href="Definition.Modality.Substitution.html#1954" class="Bound">σ</a> <a id="1967" href="Definition.Modality.Substitution.html#1882" class="Function Operator">∥</a> <a id="1969" href="Definition.Modality.Substitution.html#839" class="InductiveConstructor Operator">⊙</a> <a id="1971" href="Definition.Modality.Usage.html#2014" class="Function Operator">⌈</a> <a id="1973" href="Definition.Untyped.html#13191" class="Function">head</a> <a id="1978" href="Definition.Modality.Substitution.html#1954" class="Bound">σ</a> <a id="1980" href="Definition.Modality.Usage.html#2014" class="Function Operator">⌉</a>

<a id="1983" class="Comment">---------------------------------------------------------------</a>
<a id="2047" class="Comment">-- Modality substitutions corresponding to (term) weakenings --</a>
<a id="2111" class="Comment">---------------------------------------------------------------</a>

<a id="2176" class="Comment">-- Single step weakening of a substitution matrix</a>

<a id="wk1Substₘ"></a><a id="2227" href="Definition.Modality.Substitution.html#2227" class="Function">wk1Substₘ</a> <a id="2237" class="Symbol">:</a> <a id="2239" href="Definition.Modality.Substitution.html#785" class="Datatype">Substₘ</a> <a id="2246" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a> <a id="2248" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a> <a id="2250" class="Symbol">→</a> <a id="2252" href="Definition.Modality.Substitution.html#785" class="Datatype">Substₘ</a> <a id="2259" class="Symbol">(</a><a id="2260" href="Tools.Nat.html#406" class="InductiveConstructor">1+</a> <a id="2263" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a><a id="2264" class="Symbol">)</a> <a id="2266" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a>
<a id="2268" href="Definition.Modality.Substitution.html#2227" class="Function">wk1Substₘ</a> <a id="2278" href="Definition.Modality.Substitution.html#820" class="InductiveConstructor">[]</a> <a id="2281" class="Symbol">=</a> <a id="2283" href="Definition.Modality.Substitution.html#820" class="InductiveConstructor">[]</a>
<a id="2286" href="Definition.Modality.Substitution.html#2227" class="Function">wk1Substₘ</a> <a id="2296" class="Symbol">(</a><a id="2297" href="Definition.Modality.Substitution.html#2297" class="Bound">Ψ</a> <a id="2299" href="Definition.Modality.Substitution.html#839" class="InductiveConstructor Operator">⊙</a> <a id="2301" href="Definition.Modality.Substitution.html#2301" class="Bound">δ</a><a id="2302" class="Symbol">)</a> <a id="2304" class="Symbol">=</a> <a id="2306" class="Symbol">(</a><a id="2307" href="Definition.Modality.Substitution.html#2227" class="Function">wk1Substₘ</a> <a id="2317" href="Definition.Modality.Substitution.html#2297" class="Bound">Ψ</a><a id="2318" class="Symbol">)</a> <a id="2320" href="Definition.Modality.Substitution.html#839" class="InductiveConstructor Operator">⊙</a> <a id="2322" class="Symbol">(</a><a id="2323" href="Definition.Modality.Substitution.html#2301" class="Bound">δ</a> <a id="2325" href="Definition.Modality.Context.html#634" class="InductiveConstructor Operator">∙</a> <a id="2327" href="Definition.Modality.html#645" class="Field">𝟘</a><a id="2328" class="Symbol">)</a>

<a id="2331" class="Comment">-- Lifting a substitution matrix</a>

<a id="liftSubstₘ"></a><a id="2365" href="Definition.Modality.Substitution.html#2365" class="Function">liftSubstₘ</a> <a id="2376" class="Symbol">:</a> <a id="2378" href="Definition.Modality.Substitution.html#785" class="Datatype">Substₘ</a> <a id="2385" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a> <a id="2387" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a> <a id="2389" class="Symbol">→</a> <a id="2391" href="Definition.Modality.Substitution.html#785" class="Datatype">Substₘ</a> <a id="2398" class="Symbol">(</a><a id="2399" href="Tools.Nat.html#406" class="InductiveConstructor">1+</a> <a id="2402" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a><a id="2403" class="Symbol">)</a> <a id="2405" class="Symbol">(</a><a id="2406" href="Tools.Nat.html#406" class="InductiveConstructor">1+</a> <a id="2409" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a><a id="2410" class="Symbol">)</a>
<a id="2412" href="Definition.Modality.Substitution.html#2365" class="Function">liftSubstₘ</a> <a id="2423" href="Definition.Modality.Substitution.html#2423" class="Bound">Ψ</a> <a id="2425" class="Symbol">=</a> <a id="2427" class="Symbol">(</a><a id="2428" href="Definition.Modality.Substitution.html#2227" class="Function">wk1Substₘ</a> <a id="2438" href="Definition.Modality.Substitution.html#2423" class="Bound">Ψ</a><a id="2439" class="Symbol">)</a> <a id="2441" href="Definition.Modality.Substitution.html#839" class="InductiveConstructor Operator">⊙</a> <a id="2443" class="Symbol">(</a><a id="2444" href="Definition.Modality.Context.html#2199" class="Function">𝟘ᶜ</a> <a id="2447" href="Definition.Modality.Context.html#1005" class="Function Operator">,</a> <a id="2449" href="Data.Fin.Base.html#1168" class="InductiveConstructor">x0</a> <a id="2452" href="Definition.Modality.Context.html#1005" class="Function Operator">≔</a> <a id="2454" href="Definition.Modality.html#655" class="Field">𝟙</a><a id="2455" class="Symbol">)</a>

<a id="2458" class="Comment">-- Identity substitution matrix</a>

<a id="idSubstₘ"></a><a id="2491" href="Definition.Modality.Substitution.html#2491" class="Function">idSubstₘ</a> <a id="2500" class="Symbol">:</a> <a id="2502" href="Definition.Modality.Substitution.html#785" class="Datatype">Substₘ</a> <a id="2509" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a> <a id="2511" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a>
<a id="2513" href="Definition.Modality.Substitution.html#2491" class="Function">idSubstₘ</a> <a id="2522" class="Symbol">{</a><a id="2523" class="Argument">n</a> <a id="2525" class="Symbol">=</a> <a id="2527" class="Number">0</a><a id="2528" class="Symbol">}</a> <a id="2530" class="Symbol">=</a> <a id="2532" href="Definition.Modality.Substitution.html#820" class="InductiveConstructor">[]</a>
<a id="2535" href="Definition.Modality.Substitution.html#2491" class="Function">idSubstₘ</a> <a id="2544" class="Symbol">{</a><a id="2545" class="Argument">n</a> <a id="2547" class="Symbol">=</a> <a id="2549" href="Tools.Nat.html#406" class="InductiveConstructor">1+</a> <a id="2552" href="Definition.Modality.Substitution.html#2552" class="Bound">n</a><a id="2553" class="Symbol">}</a> <a id="2555" class="Symbol">=</a> <a id="2557" href="Definition.Modality.Substitution.html#2365" class="Function">liftSubstₘ</a> <a id="2568" href="Definition.Modality.Substitution.html#2491" class="Function">idSubstₘ</a>

<a id="2578" class="Comment">-- Substitution matrix from a weakening</a>

<a id="wkSubstₘ"></a><a id="2619" href="Definition.Modality.Substitution.html#2619" class="Function">wkSubstₘ</a> <a id="2628" class="Symbol">:</a> <a id="2630" class="Symbol">(</a><a id="2631" href="Definition.Modality.Substitution.html#2631" class="Bound">ρ</a> <a id="2633" class="Symbol">:</a> <a id="2635" href="Definition.Untyped.html#9358" class="Datatype">Wk</a> <a id="2638" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a> <a id="2640" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a><a id="2641" class="Symbol">)</a> <a id="2643" class="Symbol">→</a> <a id="2645" href="Definition.Modality.Substitution.html#785" class="Datatype">Substₘ</a> <a id="2652" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a> <a id="2654" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a>
<a id="2656" href="Definition.Modality.Substitution.html#2619" class="Function">wkSubstₘ</a> <a id="2665" href="Definition.Untyped.html#9387" class="InductiveConstructor">id</a>       <a id="2674" class="Symbol">=</a> <a id="2676" href="Definition.Modality.Substitution.html#2491" class="Function">idSubstₘ</a>
<a id="2685" href="Definition.Modality.Substitution.html#2619" class="Function">wkSubstₘ</a> <a id="2694" class="Symbol">(</a><a id="2695" href="Definition.Untyped.html#9451" class="InductiveConstructor">step</a> <a id="2700" href="Definition.Modality.Substitution.html#2700" class="Bound">ρ</a><a id="2701" class="Symbol">)</a> <a id="2703" class="Symbol">=</a> <a id="2705" href="Definition.Modality.Substitution.html#2227" class="Function">wk1Substₘ</a> <a id="2715" class="Symbol">(</a><a id="2716" href="Definition.Modality.Substitution.html#2619" class="Function">wkSubstₘ</a> <a id="2725" href="Definition.Modality.Substitution.html#2700" class="Bound">ρ</a><a id="2726" class="Symbol">)</a>
<a id="2728" href="Definition.Modality.Substitution.html#2619" class="Function">wkSubstₘ</a> <a id="2737" class="Symbol">(</a><a id="2738" href="Definition.Untyped.html#9540" class="InductiveConstructor">lift</a> <a id="2743" href="Definition.Modality.Substitution.html#2743" class="Bound">ρ</a><a id="2744" class="Symbol">)</a> <a id="2746" class="Symbol">=</a> <a id="2748" href="Definition.Modality.Substitution.html#2365" class="Function">liftSubstₘ</a> <a id="2759" class="Symbol">(</a><a id="2760" href="Definition.Modality.Substitution.html#2619" class="Function">wkSubstₘ</a> <a id="2769" href="Definition.Modality.Substitution.html#2743" class="Bound">ρ</a><a id="2770" class="Symbol">)</a>

<a id="2773" class="Comment">------------------------------------------------------------------</a>
<a id="2840" class="Comment">-- Modality substitutions corresponding to (term) substitutions --</a>
<a id="2907" class="Comment">------------------------------------------------------------------</a>

<a id="2975" class="Comment">-- Extend a  substitution matrix with a single term substitution</a>

<a id="consSubstₘ"></a><a id="3041" href="Definition.Modality.Substitution.html#3041" class="Function">consSubstₘ</a> <a id="3052" class="Symbol">:</a> <a id="3054" class="Symbol">(</a><a id="3055" href="Definition.Modality.Substitution.html#3055" class="Bound">Ψ</a> <a id="3057" class="Symbol">:</a> <a id="3059" href="Definition.Modality.Substitution.html#785" class="Datatype">Substₘ</a> <a id="3066" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a> <a id="3068" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a><a id="3069" class="Symbol">)</a> <a id="3071" class="Symbol">→</a> <a id="3073" class="Symbol">(</a><a id="3074" href="Definition.Modality.Substitution.html#3074" class="Bound">γ</a> <a id="3076" class="Symbol">:</a> <a id="3078" href="Definition.Modality.Context.html#594" class="Datatype">Conₘ</a> <a id="3083" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a><a id="3084" class="Symbol">)</a> <a id="3086" class="Symbol">→</a> <a id="3088" href="Definition.Modality.Substitution.html#785" class="Datatype">Substₘ</a> <a id="3095" href="Definition.Modality.Substitution.html#690" class="Generalizable">m</a> <a id="3097" class="Symbol">(</a><a id="3098" href="Tools.Nat.html#406" class="InductiveConstructor">1+</a> <a id="3101" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a><a id="3102" class="Symbol">)</a>
<a id="3104" href="Definition.Modality.Substitution.html#3041" class="Function">consSubstₘ</a> <a id="3115" class="Symbol">=</a> <a id="3117" href="Definition.Modality.Substitution.html#839" class="InductiveConstructor Operator">_⊙_</a>

<a id="3122" class="Comment">-- Single term substitution matrix</a>

<a id="sgSubstₘ"></a><a id="3158" href="Definition.Modality.Substitution.html#3158" class="Function">sgSubstₘ</a> <a id="3167" class="Symbol">:</a> <a id="3169" class="Symbol">(</a><a id="3170" href="Definition.Modality.Substitution.html#3170" class="Bound">γ</a> <a id="3172" class="Symbol">:</a> <a id="3174" href="Definition.Modality.Context.html#594" class="Datatype">Conₘ</a> <a id="3179" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a><a id="3180" class="Symbol">)</a> <a id="3182" class="Symbol">→</a> <a id="3184" href="Definition.Modality.Substitution.html#785" class="Datatype">Substₘ</a> <a id="3191" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a> <a id="3193" class="Symbol">(</a><a id="3194" href="Tools.Nat.html#406" class="InductiveConstructor">1+</a> <a id="3197" href="Definition.Modality.Substitution.html#692" class="Generalizable">n</a><a id="3198" class="Symbol">)</a>
<a id="3200" href="Definition.Modality.Substitution.html#3158" class="Function">sgSubstₘ</a> <a id="3209" class="Symbol">=</a> <a id="3211" href="Definition.Modality.Substitution.html#3041" class="Function">consSubstₘ</a> <a id="3222" href="Definition.Modality.Substitution.html#2491" class="Function">idSubstₘ</a>
</pre></body></html>